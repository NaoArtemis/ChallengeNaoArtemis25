<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ongoing Match</title>
    <link rel="website icon" type="png" href="{{ url_for('static', filename='img/logo_v1.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>

    <!-- barra superiore-->
    <div class="top-bar">
        <div class="logo">
            <img src="{{ url_for('static', filename='img/logo_con_scritta.png') }}" alt="BetterNao Logo">
        </div>
        <div class="top-bar-buttons">
            <button id="home" class="btn btn-logout">Home</button>
            <button id="logout" class="btn btn-logout">Logout</button>
        </div>
    </div>

    <!-- main -->
    <div class="main-content">
        <h1 class = "main-text">Gestione Partita</h1>

        <!-- Messaggio di stato -->
        <div id="status-message" style="margin-top: 15px; font-weight: bold; color: #333;"></div>

        <!-- Controlli partita -->
        <div>
            <button class="btn btn-joystick" onclick="iniziaPartita()">Inizia Partita</button>
            <button class="btn btn-joystick" onclick="finePartita()">Fine Partita</button>
            <button class="btn btn-joystick" onclick="analyze()">Analyze</button>
        </div>

        <div class = "dashboard">
            <div class = "joystick-panel">

                <!-- Video Voronoi -->        
                <div>
                    <h2 class = "text">Video Voronoi</h2>
                    <!-- Nuovo container per caricare video solo al click -->
                    <div id="voronoi-container"></div>
                    <button class="btn btn-joystick" onclick="caricaVoronoi()">Carica Video Voronoi</button>
                </div>
            </div>

            <!-- Heatmap giocatori -->
            <div class = "joystick-panel">
                <h2 class = "text">Heatmap Giocatori</h2>
                <button class="btn btn-joystick" onclick="aggiornaListaGiocatori()">Aggiorna Heatmap</button>
                <!-- Container per la heatmap -->
                <div  id="heatmap-container" style="margin-top: 20px;"></div>
        </div>

            </div>

        <!-- Script -->
        <script>
            function iniziaPartita() {
                fetch('/inizia_partita').then(() => {
                    document.getElementById("status-message").innerText = "✅ Registrazione partita avviata";
                });
            }

            function finePartita() {
                fetch('/fine_partita').then(() => {
                    document.getElementById("status-message").innerText = "✅ Registrazione terminata. Puoi ora avviare l'analisi";
                });
            }

            function analyze() {
                fetch('/analyze').then(() => {
                    document.getElementById("status-message").innerText = "✅ Analisi partita avviata... Attendere qualche minuto";
                    setTimeout(() => {
                        document.getElementById("status-message").innerText = "✅ Analisi completata con successo!";
                    }, 5000);
                });
            }

            function aggiornaListaGiocatori() {
                fetch('/api/players')
                    .then(response => response.json())
                    .then(players => {
                        let container = document.getElementById("heatmap-container");
                        container.innerHTML = '<h2>Seleziona giocatore per visualizzare la Heatmap</h2>';
                        players.forEach(player => {
                            let btn = document.createElement("button");
                            btn.className = "btn btn-joystick";
                            btn.textContent = player;
                            btn.onclick = () => showHeatmap(player);
                            container.appendChild(btn);
                        });
                    });
            }

            function showHeatmap(player_id) {
                document.getElementById("heatmap-container").innerHTML = '<img src="/heatmap/' + player_id + '" alt="Heatmap ' + player_id + '" style="max-width: 80%; border: 2px solid #333;">';
            }

            function caricaVoronoi() {
                document.getElementById("voronoi-container").innerHTML =
                    '<video controls style="max-width: 80%; border: 2px solid #333;">' +
                    '<source src="/stream_voronoi" type="video/mp4">' +
                    'Il tuo browser non supporta il video.' +
                    '</video>';
            }
        </script>

    </div>

    <!--  JS -->
    <script src="{{ url_for('static', filename='script/script.js') }}"></script>

</body>
</html>
